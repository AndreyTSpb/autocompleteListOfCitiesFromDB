# autocompleteListOfCitiesFromDB
# JS. autocomplete list of cities from DB

Атоматическое создание списка городов при заполнении инпута пользователем. 
Список подтягивается из БД и сохраняется в массив, 
пока в этом массиве будут находиться совпадения список обновляться не будет. 
Т.е. сокрашяется обращение к БД.

## Для работы:
1) В HTML фаиле подключить фаил скрипта 
```html
<script type="text/javascript" src="auto_add_city.js"></script>
```
2) инпуту добавить идентификатор "city-input" и атрибут list = "list-city", больше в HTML делать ничего не нужно
 ```html
 <input type="text" class="form-control" name="city" id="city-input" list = "list-city" value="">
 ```
3) Фаил POST.php для обработки AJAX запроса. $link - ссылка на подключение к БД. Ожидает переменные POST запросом:
  ```php
  isset($_POST['get_city']) && !empty($_POST['city'])
  ```
  Обращаться будет к таблице "geo_city" в БД
  ```php
  $sql = "SELECT name FROM geo_city WHERE name LIKE '".$city."%'";
  ```
  
4) В БД импортировать файл geo_city.sql, в нем списк городой с идентификаторами регионов.
 
 
## Как работает:
1) Пользователь начинает вводить название в инпут
2) Функция listenerInput() проверяет если флаг "test" не взведен, то сделать запрос к БД.
3) Запрос к БД делается аяксом это значение отправляется в post.php.
3) В post.php проверяется какие данные переданы и происходит зачистка всего кроме русских букв
```php
$city = preg_replace('/[^а-я]+/msiu', '',strip_tags(trim($_POST['city'])));
```
4) Делается запрос к БД, если что-то находит то возвращает json объект с выборкой городов.
5) Если данные полученны, запускаем функцию создания списка городов "create_list_city"
6) Если массив с городами уже существует, то проверяем есть ли введеное пользователем значение в этом массиве.
7) Если есть, то не запускаем новую выборку из БД, а взводим флаг "test" в ИСТИНА
